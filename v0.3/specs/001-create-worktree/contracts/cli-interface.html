<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>CLI Interface Contract: Worktree Create Command | wt </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="CLI Interface Contract: Worktree Create Command | wt ">
      
      
      <link rel="icon" href="../../../favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/kuju63/wt/blob/main/specs/001-create-worktree/contracts/cli-interface.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../logo.svg" alt="wt">
            wt
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="cli-interface-contract-worktree-create-command">CLI Interface Contract: Worktree Create Command</h1>

<p><strong>Feature</strong>: 001-create-worktree<br>
<strong>Date</strong>: 2026-01-03<br>
<strong>Version</strong>: 1.0.0</p>
<h2 id="command-syntax">Command Syntax</h2>
<pre><code class="lang-bash">wt create &lt;branch-name&gt; [OPTIONS]
</code></pre>
<p><strong>Note</strong>: <code>wt</code>自体が「worktree tool」を意味するため、<code>worktree</code>サブコマンドは省略しています。シンプルで使いやすいCLIを実現します。</p>
<h2 id="arguments">Arguments</h2>
<h3 id="required">Required</h3>
<ul>
<li><code>&lt;branch-name&gt;</code>: 作成する新しいブランチ名
<ul>
<li><strong>Type</strong>: string</li>
<li><strong>Validation</strong>: Git命名規則に準拠（英数字、<code>-</code>、<code>_</code>、<code>/</code>のみ）</li>
<li><strong>Example</strong>: <code>feature-x</code>, <code>bugfix/issue-123</code>, <code>user_story_1</code></li>
</ul>
</li>
</ul>
<h2 id="options">Options</h2>
<h3 id="--base--b">--base, -b</h3>
<p>ベースブランチの指定（デフォルト: 現在のブランチ）</p>
<ul>
<li><strong>Type</strong>: string</li>
<li><strong>Default</strong>: 現在のブランチ</li>
<li><strong>Example</strong>: <code>--base main</code> または <code>-b develop</code></li>
</ul>
<h3 id="--path--p">--path, -p</h3>
<p>Worktreeを作成するパス（デフォルト: <code>../worktrees/&lt;branch-name&gt;</code>）</p>
<ul>
<li><strong>Type</strong>: string (絶対パスまたは相対パス)</li>
<li><strong>Default</strong>: <code>../worktrees/&lt;branch-name&gt;</code></li>
<li><strong>Example</strong>: <code>--path ~/projects/my-worktree</code> または <code>-p ../feature-branch</code></li>
</ul>
<h3 id="--editor--e">--editor, -e</h3>
<p>Worktree作成後に起動するエディター</p>
<ul>
<li><strong>Type</strong>: string (enum: vscode|vim|emacs|nano|idea)</li>
<li><strong>Default</strong>: なし（エディターを起動しない）</li>
<li><strong>Example</strong>: <code>--editor vscode</code> または <code>-e vim</code></li>
</ul>
<h3 id="--checkout-existing">--checkout-existing</h3>
<p>既存ブランチが存在する場合、それをチェックアウトする</p>
<ul>
<li><strong>Type</strong>: boolean flag</li>
<li><strong>Default</strong>: false</li>
<li><strong>Example</strong>: <code>--checkout-existing</code></li>
</ul>
<h3 id="--output--o">--output, -o</h3>
<p>出力形式の指定</p>
<ul>
<li><strong>Type</strong>: string (enum: human|json)</li>
<li><strong>Default</strong>: human</li>
<li><strong>Example</strong>: <code>--output json</code> または <code>-o json</code></li>
</ul>
<h3 id="--verbose--v">--verbose, -v</h3>
<p>詳細な診断情報を出力</p>
<ul>
<li><strong>Type</strong>: boolean flag</li>
<li><strong>Default</strong>: false</li>
<li><strong>Example</strong>: <code>--verbose</code> または <code>-v</code></li>
</ul>
<h3 id="--help--h">--help, -h</h3>
<p>ヘルプメッセージを表示</p>
<ul>
<li><strong>Type</strong>: boolean flag</li>
<li><strong>Example</strong>: <code>--help</code> または <code>-h</code></li>
</ul>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="example-1-基本的な使用方法">Example 1: 基本的な使用方法</h3>
<pre><code class="lang-bash">$ wt create feature-login
✓ Created branch 'feature-login' from 'main'
✓ Added worktree at: /Users/dev/projects/worktrees/feature-login
→ Next: cd /Users/dev/projects/worktrees/feature-login
</code></pre>
<h3 id="example-2-ベースブランチを指定">Example 2: ベースブランチを指定</h3>
<pre><code class="lang-bash">$ wt create hotfix-123 --base production
✓ Created branch 'hotfix-123' from 'production'
✓ Added worktree at: /Users/dev/projects/worktrees/hotfix-123
→ Next: cd /Users/dev/projects/worktrees/hotfix-123
</code></pre>
<h3 id="example-3-エディターを起動">Example 3: エディターを起動</h3>
<pre><code class="lang-bash">$ wt create feature-ui --editor vscode
✓ Created branch 'feature-ui' from 'main'
✓ Added worktree at: /Users/dev/projects/worktrees/feature-ui
✓ Launched VS Code
</code></pre>
<h3 id="example-4-カスタムパスを指定">Example 4: カスタムパスを指定</h3>
<pre><code class="lang-bash">$ wt create experiment --path ~/experiments/test-feature
✓ Created branch 'experiment' from 'main'
✓ Added worktree at: /Users/dev/experiments/test-feature
→ Next: cd /Users/dev/experiments/test-feature
</code></pre>
<h3 id="example-5-json出力">Example 5: JSON出力</h3>
<pre><code class="lang-bash">$ wt create api-v2 --output json
{
  &quot;success&quot;: true,
  &quot;worktree&quot;: {
    &quot;path&quot;: &quot;/Users/dev/projects/worktrees/api-v2&quot;,
    &quot;branch&quot;: &quot;api-v2&quot;,
    &quot;baseBranch&quot;: &quot;main&quot;,
    &quot;createdAt&quot;: &quot;2026-01-03T13:15:30Z&quot;
  },
  &quot;editorLaunched&quot;: false
}
</code></pre>
<h3 id="example-6-既存ブランチをチェックアウト">Example 6: 既存ブランチをチェックアウト</h3>
<pre><code class="lang-bash">$ wt create feature-x
✗ Error: Branch 'feature-x' already exists
→ Solution: Use --checkout-existing to checkout the existing branch

$ wt create feature-x --checkout-existing
✓ Checked out existing branch 'feature-x'
✓ Added worktree at: /Users/dev/projects/worktrees/feature-x
→ Next: cd /Users/dev/projects/worktrees/feature-x
</code></pre>
<h3 id="example-7-verbose-モード">Example 7: Verbose モード</h3>
<pre><code class="lang-bash">$ wt create test --verbose
[DEBUG] Checking for Git repository...
[DEBUG] Found Git repository at: /Users/dev/projects/my-repo
[DEBUG] Current branch: main
[DEBUG] Checking if branch 'test' exists...
[DEBUG] Branch 'test' does not exist
[DEBUG] Creating branch 'test' from 'main'...
[DEBUG] Executing: git branch test main
[DEBUG] Creating worktree at: /Users/dev/projects/worktrees/test
[DEBUG] Executing: git worktree add /Users/dev/projects/worktrees/test test
✓ Created branch 'test' from 'main'
✓ Added worktree at: /Users/dev/projects/worktrees/test
→ Next: cd /Users/dev/projects/worktrees/test
</code></pre>
<h2 id="exit-codes">Exit Codes</h2>
<table>
<thead>
<tr>
<th>Code</th>
<th>Meaning</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Success</td>
<td>Worktree created successfully</td>
</tr>
<tr>
<td>1</td>
<td>General Error</td>
<td>Unspecified error occurred</td>
</tr>
<tr>
<td>2</td>
<td>Invalid Arguments</td>
<td>Command-line arguments are invalid</td>
</tr>
<tr>
<td>10</td>
<td>Git Not Found</td>
<td>Git is not installed or not in PATH</td>
</tr>
<tr>
<td>11</td>
<td>Not Git Repository</td>
<td>Current directory is not a Git repository</td>
</tr>
<tr>
<td>12</td>
<td>Git Command Failed</td>
<td>Git command execution failed</td>
</tr>
<tr>
<td>20</td>
<td>Invalid Branch Name</td>
<td>Branch name doesn't follow Git naming rules</td>
</tr>
<tr>
<td>21</td>
<td>Branch Exists</td>
<td>Branch already exists and --checkout-existing not specified</td>
</tr>
<tr>
<td>30</td>
<td>Worktree Exists</td>
<td>Worktree with same name already exists</td>
</tr>
<tr>
<td>31</td>
<td>Invalid Path</td>
<td>Specified path is invalid</td>
</tr>
<tr>
<td>32</td>
<td>Path Not Writable</td>
<td>Don't have write permissions to target directory</td>
</tr>
<tr>
<td>40</td>
<td>Disk Space Low</td>
<td>Insufficient disk space</td>
</tr>
<tr>
<td>50</td>
<td>Editor Not Found</td>
<td>Specified editor is not found (warning, not fatal)</td>
</tr>
</tbody>
</table>
<h2 id="error-handling">Error Handling</h2>
<h3 id="standard-error-format-human">Standard Error Format (Human)</h3>
<pre><code class="lang-shell">✗ Error: &lt;Error Message&gt;
→ Solution: &lt;Suggested Solution&gt;

Additional Details:
&lt;Optional Details&gt;
</code></pre>
<h3 id="json-error-format">JSON Error Format</h3>
<pre><code class="lang-json">{
  &quot;success&quot;: false,
  &quot;error&quot;: {
    &quot;code&quot;: &quot;BR002&quot;,
    &quot;message&quot;: &quot;Branch 'feature-x' already exists&quot;,
    &quot;solution&quot;: &quot;Use --checkout-existing to checkout the existing branch&quot;,
    &quot;details&quot;: &quot;Branch 'feature-x' was created on 2026-01-02 at commit abc123&quot;
  },
  &quot;warnings&quot;: []
}
</code></pre>
<h2 id="environment-variables">Environment Variables</h2>
<h3 id="wt_default_worktree_path">WT_DEFAULT_WORKTREE_PATH</h3>
<p>デフォルトのworktreeパスを設定</p>
<ul>
<li><strong>Type</strong>: string</li>
<li><strong>Default</strong>: <code>../worktrees</code></li>
<li><strong>Example</strong>: <code>export WT_DEFAULT_WORKTREE_PATH=~/my-worktrees</code></li>
</ul>
<h3 id="wt_default_editor">WT_DEFAULT_EDITOR</h3>
<p>デフォルトのエディターを設定</p>
<ul>
<li><strong>Type</strong>: string</li>
<li><strong>Default</strong>: なし</li>
<li><strong>Example</strong>: <code>export WT_DEFAULT_EDITOR=vscode</code></li>
</ul>
<h2 id="validation-rules">Validation Rules</h2>
<h3 id="branch-name-validation">Branch Name Validation</h3>
<ol>
<li>空文字列ではない</li>
<li>以下の文字のみ: <code>a-zA-Z0-9</code>, <code>-</code>, <code>_</code>, <code>/</code></li>
<li>以下で開始しない: <code>-</code>, <code>.</code></li>
<li>以下を含まない: <code>..</code>, <code>@{</code>, <code>\</code>, スペース、制御文字</li>
</ol>
<h3 id="path-validation">Path Validation</h3>
<ol>
<li>空文字列ではない</li>
<li>親ディレクトリが存在する</li>
<li>書き込み権限がある</li>
<li>十分なディスク容量がある（最低100MB）</li>
</ol>
<h3 id="editor-validation">Editor Validation</h3>
<ol>
<li>プリセットまたはカスタムコマンドのいずれか</li>
<li>カスタムコマンドは実行可能ファイルとしてPATHに存在</li>
</ol>
<h2 id="performance-expectations">Performance Expectations</h2>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Target Time</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>バリデーション</td>
<td>&lt; 100ms</td>
<td>入力チェック</td>
</tr>
<tr>
<td>Gitリポジトリ確認</td>
<td>&lt; 200ms</td>
<td><code>.git</code>ディレクトリ検索</td>
</tr>
<tr>
<td>ブランチ作成</td>
<td>&lt; 1s</td>
<td>Gitコマンド実行</td>
</tr>
<tr>
<td>Worktree追加</td>
<td>&lt; 2s</td>
<td>ファイルコピー含む</td>
</tr>
<tr>
<td>エディター起動</td>
<td>&lt; 1s</td>
<td>プロセス起動</td>
</tr>
<tr>
<td><strong>Total</strong></td>
<td><strong>&lt; 5s</strong></td>
<td>通常のケース</td>
</tr>
</tbody>
</table>
<h2 id="compatibility">Compatibility</h2>
<h3 id="minimum-requirements">Minimum Requirements</h3>
<ul>
<li>Git 2.5+ (git worktree サポート)</li>
<li>100MB ディスク空き容量</li>
</ul>
<p><strong>Note</strong>: Self-contained deployment（ワンバイナリ）として配布するため、.NET Runtimeのインストールは不要です。</p>
<h3 id="supported-platforms">Supported Platforms</h3>
<ul>
<li>✅ Windows 10+</li>
<li>✅ macOS 11+</li>
<li>✅ Linux (Ubuntu 20.04+, その他主要ディストリビューション)</li>
</ul>
<h3 id="supported-editors">Supported Editors</h3>
<ul>
<li>✅ Visual Studio Code</li>
<li>✅ Vim</li>
<li>✅ Emacs</li>
<li>✅ Nano</li>
<li>✅ IntelliJ IDEA</li>
</ul>
<h2 id="security-considerations">Security Considerations</h2>
<ol>
<li><strong>Command Injection Prevention</strong>: ユーザー入力はサニタイズされ、Gitコマンドに直接渡されない</li>
<li><strong>Path Traversal Prevention</strong>: パスは正規化され、許可されたディレクトリ内に制限される</li>
<li><strong>Validation</strong>: すべての入力は厳格にバリデーションされる</li>
</ol>
<h2 id="future-extensions-out-of-scope-for-v10">Future Extensions (Out of Scope for v1.0)</h2>
<ul>
<li><code>wt list</code>: 既存worktreeの一覧表示</li>
<li><code>wt remove &lt;branch&gt;</code>: Worktreeの削除</li>
<li><code>wt switch &lt;branch&gt;</code>: Worktree間の切り替え</li>
<li><code>wt status</code>: すべてのworktreeのステータス表示</li>
</ul>
<p><strong>Design Philosophy</strong>: <code>wt</code>自体がworktree管理ツールであるため、<code>worktree</code>サブコマンドグループは不要。すべてのコマンドはトップレベルに配置し、シンプルで覚えやすいCLIを実現します。</p>
<h2 id="changelog">Changelog</h2>
<h3 id="100-2026-01-03">1.0.0 (2026-01-03)</h3>
<ul>
<li>Initial specification</li>
<li>Basic worktree creation</li>
<li>Editor integration</li>
<li>Cross-platform support</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/kuju63/wt/blob/main/specs/001-create-worktree/contracts/cli-interface.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
