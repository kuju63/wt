<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Phase 1: Data Model | wt </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Phase 1: Data Model | wt ">
      
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/kuju63/wt/blob/main/specs/004-complete-sbom-generation/data-model.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="wt">
            wt
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="phase-1-data-model">Phase 1: Data Model</h1>

<p>SBOM生成機能はCI/CDパイプライン（ワークフロー）の変更のみで実現するため、アプリケーションコード内で使用する新しいデータモデルは基本的に不要です。ここでは、SBOM生成プロセスで扱う概念的なデータ構造を文書化します。</p>
<hr>
<h2 id="1-sbom-document-spdx-23形式">1. SBOM Document (SPDX 2.3形式)</h2>
<h3 id="概要">概要</h3>
<p>Microsoft SBOM Toolが生成するSPDX 2.3形式のJSON文書。</p>
<h3 id="構造">構造</h3>
<pre><code class="lang-typescript">interface SpdxDocument {
  spdxVersion: &quot;SPDX-2.3&quot;;
  dataLicense: &quot;CC0-1.0&quot;;
  SPDXID: string;  // &quot;SPDXRef-DOCUMENT&quot;
  name: string;    // プロジェクト名
  documentNamespace: string;  // 一意のURI
  creationInfo: CreationInfo;
  packages: Package[];
  relationships: Relationship[];
}

interface CreationInfo {
  created: string;  // ISO 8601形式
  creators: string[];  // &quot;Tool: Microsoft.Sbom.Tool-x.x.x&quot;
  licenseListVersion?: string;
}

interface Package {
  SPDXID: string;  // &quot;SPDXRef-Package-{hash}&quot;
  name: string;
  versionInfo: string;
  downloadLocation: string;  // NuGetパッケージURL
  filesAnalyzed: boolean;
  licenseConcluded: string;  // SPDX License Identifier or &quot;NOASSERTION&quot;
  licenseDeclared: string;
  copyrightText: string;
  externalRefs?: ExternalRef[];
}

interface ExternalRef {
  referenceCategory: &quot;PACKAGE-MANAGER&quot;;
  referenceType: &quot;purl&quot;;
  referenceLocator: string;  // Package URL形式
}

interface Relationship {
  spdxElementId: string;
  relationshipType: &quot;DEPENDS_ON&quot; | &quot;DESCRIBES&quot; | &quot;CONTAINS&quot;;
  relatedSpdxElement: string;
}
</code></pre>
<h3 id="使用例">使用例</h3>
<pre><code class="lang-json">{
  &quot;spdxVersion&quot;: &quot;SPDX-2.3&quot;,
  &quot;dataLicense&quot;: &quot;CC0-1.0&quot;,
  &quot;SPDXID&quot;: &quot;SPDXRef-DOCUMENT&quot;,
  &quot;name&quot;: &quot;wt CLI Tool&quot;,
  &quot;documentNamespace&quot;: &quot;https://github.com/kuju63/wt/sbom/v1.0.0-20260106&quot;,
  &quot;creationInfo&quot;: {
    &quot;created&quot;: &quot;2026-01-06T12:00:00Z&quot;,
    &quot;creators&quot;: [&quot;Tool: Microsoft.Sbom.Tool-2.2.0&quot;]
  },
  &quot;packages&quot;: [
    {
      &quot;SPDXID&quot;: &quot;SPDXRef-Package-1234&quot;,
      &quot;name&quot;: &quot;System.CommandLine&quot;,
      &quot;versionInfo&quot;: &quot;2.0.1&quot;,
      &quot;downloadLocation&quot;: &quot;https://www.nuget.org/packages/System.CommandLine/2.0.1&quot;,
      &quot;filesAnalyzed&quot;: false,
      &quot;licenseConcluded&quot;: &quot;MIT&quot;,
      &quot;licenseDeclared&quot;: &quot;MIT&quot;,
      &quot;copyrightText&quot;: &quot;Copyright Microsoft Corporation&quot;,
      &quot;externalRefs&quot;: [
        {
          &quot;referenceCategory&quot;: &quot;PACKAGE-MANAGER&quot;,
          &quot;referenceType&quot;: &quot;purl&quot;,
          &quot;referenceLocator&quot;: &quot;pkg:nuget/System.CommandLine@2.0.1&quot;
        }
      ]
    }
  ],
  &quot;relationships&quot;: [
    {
      &quot;spdxElementId&quot;: &quot;SPDXRef-DOCUMENT&quot;,
      &quot;relationshipType&quot;: &quot;DESCRIBES&quot;,
      &quot;relatedSpdxElement&quot;: &quot;SPDXRef-Package-1234&quot;
    }
  ]
}
</code></pre>
<hr>
<h2 id="2-dependency-snapshot-github-api形式">2. Dependency Snapshot (GitHub API形式)</h2>
<h3 id="概要-1">概要</h3>
<p>GitHub Dependency Submission APIに送信する依存関係スナップショット。</p>
<h3 id="構造-1">構造</h3>
<pre><code class="lang-typescript">interface DependencySnapshot {
  version: 0;  // APIバージョン
  sha: string;  // コミットSHA
  ref: string;  // ブランチ参照（例: &quot;refs/heads/main&quot;）
  job: JobInfo;
  detector: DetectorInfo;
  scanned: string;  // ISO 8601形式
  manifests: Record&lt;string, Manifest&gt;;
}

interface JobInfo {
  correlator: string;  // ワークフロー識別子
  id: string;  // ジョブID
}

interface DetectorInfo {
  name: string;  // &quot;Microsoft SBOM Tool&quot;
  version: string;
  url: string;
}

interface Manifest {
  name: string;  // マニフェストファイル名
  file?: {
    source_location: string;
  };
  resolved: Record&lt;string, Dependency&gt;;
}

interface Dependency {
  package_url: string;  // Package URL (purl)
  relationship: &quot;direct&quot; | &quot;indirect&quot;;
  scope?: &quot;runtime&quot; | &quot;development&quot;;
  dependencies?: string[];  // 依存パッケージのpurlリスト
}
</code></pre>
<h3 id="使用例-1">使用例</h3>
<pre><code class="lang-json">{
  &quot;version&quot;: 0,
  &quot;sha&quot;: &quot;abc123...&quot;,
  &quot;ref&quot;: &quot;refs/heads/main&quot;,
  &quot;job&quot;: {
    &quot;correlator&quot;: &quot;release-publish&quot;,
    &quot;id&quot;: &quot;12345678&quot;
  },
  &quot;detector&quot;: {
    &quot;name&quot;: &quot;Microsoft SBOM Tool&quot;,
    &quot;version&quot;: &quot;2.2.0&quot;,
    &quot;url&quot;: &quot;https://github.com/microsoft/sbom-tool&quot;
  },
  &quot;scanned&quot;: &quot;2026-01-06T12:00:00Z&quot;,
  &quot;manifests&quot;: {
    &quot;wt.cli.csproj&quot;: {
      &quot;name&quot;: &quot;wt.cli&quot;,
      &quot;file&quot;: {
        &quot;source_location&quot;: &quot;wt.cli/wt.cli.csproj&quot;
      },
      &quot;resolved&quot;: {
        &quot;System.CommandLine@2.0.1&quot;: {
          &quot;package_url&quot;: &quot;pkg:nuget/System.CommandLine@2.0.1&quot;,
          &quot;relationship&quot;: &quot;direct&quot;,
          &quot;scope&quot;: &quot;runtime&quot;,
          &quot;dependencies&quot;: [
            &quot;pkg:nuget/System.Memory@4.5.5&quot;
          ]
        },
        &quot;System.Memory@4.5.5&quot;: {
          &quot;package_url&quot;: &quot;pkg:nuget/System.Memory@4.5.5&quot;,
          &quot;relationship&quot;: &quot;indirect&quot;,
          &quot;scope&quot;: &quot;runtime&quot;
        }
      }
    }
  }
}
</code></pre>
<hr>
<h2 id="3-workflow-configuration-github-actions">3. Workflow Configuration (GitHub Actions)</h2>
<h3 id="概要-2">概要</h3>
<p>ワークフロー定義で使用する設定パラメータ。</p>
<h3 id="構造-2">構造</h3>
<pre><code class="lang-typescript">interface WorkflowConfig {
  sbom: SbomConfig;
  github: GitHubConfig;
  performance: PerformanceConfig;
}

interface SbomConfig {
  outputDir: string;  // SBOM出力ディレクトリ（例: &quot;_manifest&quot;）
  fileName: string;   // SBOMファイル名（例: &quot;sbom.spdx.json&quot;）
  format: &quot;spdx&quot;;     // フォーマット
  packageName: string;  // パッケージ名
  packageVersion: string;  // バージョン
  namespace: string;  // ドキュメント名前空間URI
}

interface GitHubConfig {
  repository: string;  // リポジトリ名（owner/repo）
  token: string;       // GITHUB_TOKEN
  releaseTag: string;  // リリースタグ
  permissions: {
    contents: &quot;write&quot;;
    idToken: &quot;write&quot;;
  };
}

interface PerformanceConfig {
  restoreTimeout: number;  // リストアタイムアウト（分）
  sbomTimeout: number;     // SBOM生成タイムアウト（分）
  cacheEnabled: boolean;   // キャッシュ有効化
  cachePath: string;       // キャッシュパス
  cacheKey: string;        // キャッシュキー
}
</code></pre>
<h3 id="使用例github-actionsワークフロー">使用例（GitHub Actionsワークフロー）</h3>
<pre><code class="lang-yaml">env:
  SBOM_OUTPUT_DIR: _manifest
  SBOM_FILE_NAME: sbom.spdx.json
  PACKAGE_NAME: ${{ github.repository }}
  PACKAGE_VERSION: ${{ steps.version.outputs.version }}
  NAMESPACE: https://github.com/${{ github.repository }}/sbom/${{ steps.version.outputs.version }}
  
jobs:
  generate-sbom:
    permissions:
      contents: write
      id-token: write
    timeout-minutes: 15
</code></pre>
<hr>
<h2 id="4-package-url-purl-形式">4. Package URL (purl) 形式</h2>
<h3 id="概要-3">概要</h3>
<p>依存関係パッケージを一意に識別するための標準形式。</p>
<h3 id="構造-3">構造</h3>
<pre><code class="lang-text">pkg:&lt;type&gt;/&lt;namespace&gt;/&lt;name&gt;@&lt;version&gt;?&lt;qualifiers&gt;#&lt;subpath&gt;

# NuGetの例
pkg:nuget/System.CommandLine@2.0.1

# プラットフォーム固有の例
pkg:nuget/System.CommandLine@2.0.1?targetframework=net10.0
</code></pre>
<h3 id="typescript型定義">TypeScript型定義</h3>
<pre><code class="lang-typescript">interface PackageUrl {
  type: &quot;nuget&quot; | &quot;npm&quot; | &quot;pypi&quot; | &quot;maven&quot; | ...;
  namespace?: string;
  name: string;
  version: string;
  qualifiers?: Record&lt;string, string&gt;;
  subpath?: string;
}

function formatPurl(purl: PackageUrl): string {
  let result = `pkg:${purl.type}`;
  if (purl.namespace) result += `/${purl.namespace}`;
  result += `/${purl.name}`;
  if (purl.version) result += `@${purl.version}`;
  
  if (purl.qualifiers) {
    const queries = Object.entries(purl.qualifiers)
      .map(([k, v]) =&gt; `${k}=${v}`)
      .join('&amp;');
    result += `?${queries}`;
  }
  
  if (purl.subpath) result += `#${purl.subpath}`;
  return result;
}
</code></pre>
<hr>
<h2 id="5-release-asset-metadata">5. Release Asset Metadata</h2>
<h3 id="概要-4">概要</h3>
<p>GitHubリリースに添付するSBOMファイルのメタデータ。</p>
<h3 id="構造-4">構造</h3>
<pre><code class="lang-typescript">interface ReleaseAsset {
  name: string;  // &quot;wt-v1.0.0-sbom.spdx.json&quot;
  label: string;  // &quot;SBOM (SPDX 2.3)&quot;
  contentType: &quot;application/json&quot;;
  size: number;  // バイト数
  state: &quot;uploaded&quot;;
  browserDownloadUrl: string;  // ダウンロードURL
}
</code></pre>
<h3 id="使用例-2">使用例</h3>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;wt-v1.0.0-sbom.spdx.json&quot;,
  &quot;label&quot;: &quot;SBOM (SPDX 2.3)&quot;,
  &quot;contentType&quot;: &quot;application/json&quot;,
  &quot;size&quot;: 45678,
  &quot;state&quot;: &quot;uploaded&quot;,
  &quot;browserDownloadUrl&quot;: &quot;https://github.com/kuju63/wt/releases/download/v1.0.0/wt-v1.0.0-sbom.spdx.json&quot;
}
</code></pre>
<hr>
<h2 id="データフロー図">データフロー図</h2>
<pre><code class="lang-mermaid">graph TD
    A[dotnet restore] --&gt; B[packages.lock.json]
    B --&gt; C[Microsoft SBOM Tool]
    C --&gt; D[sbom.spdx.json]
    D --&gt; E[GitHub Dependency Submission API]
    D --&gt; F[GitHub Release Asset]
    E --&gt; G[Dependency Graph]
    G --&gt; H[Dependabot Alerts]
    G --&gt; I[Renovate Integration]
</code></pre>
<hr>
<h2 id="エンティティ関係図">エンティティ関係図</h2>
<pre><code class="lang-mermaid">erDiagram
    SPDX-DOCUMENT ||--o{ PACKAGE : contains
    PACKAGE ||--o{ EXTERNAL-REF : has
    PACKAGE }o--o{ PACKAGE : depends-on
    SPDX-DOCUMENT ||--|{ RELATIONSHIP : defines
    
    DEPENDENCY-SNAPSHOT ||--o{ MANIFEST : includes
    MANIFEST ||--o{ DEPENDENCY : resolved
    DEPENDENCY }o--o{ DEPENDENCY : depends-on
    
    GITHUB-RELEASE ||--o{ RELEASE-ASSET : attaches
    RELEASE-ASSET ||--|| SPDX-DOCUMENT : contains
</code></pre>
<hr>
<h2 id="状態遷移図">状態遷移図</h2>
<pre><code class="lang-mermaid">stateDiagram-v2
    [*] --&gt; Restoring: dotnet restore
    Restoring --&gt; Restored: Success
    Restoring --&gt; Failed: Failure
    Restored --&gt; Generating: sbom-tool generate
    Generating --&gt; Generated: Success
    Generating --&gt; Failed: Failure
    Generated --&gt; Submitting: API submission
    Submitting --&gt; Submitted: Success (201)
    Submitting --&gt; Failed: Failure (4xx/5xx)
    Generated --&gt; Uploading: Release asset
    Uploading --&gt; Uploaded: Success
    Uploading --&gt; Failed: Failure
    Submitted --&gt; [*]
    Uploaded --&gt; [*]
    Failed --&gt; [*]: Pipeline fails
</code></pre>
<hr>
<h2 id="バリデーションルール">バリデーションルール</h2>
<h3 id="spdx-document">SPDX Document</h3>
<ul>
<li><code>spdxVersion</code> は &quot;SPDX-2.3&quot; 固定</li>
<li><code>dataLicense</code> は &quot;CC0-1.0&quot; 固定</li>
<li><code>documentNamespace</code> は一意のURI（リポジトリ + バージョン + タイムスタンプ）</li>
<li><code>packages</code> は1個以上必要</li>
</ul>
<h3 id="package">Package</h3>
<ul>
<li><code>name</code> と <code>versionInfo</code> は必須</li>
<li><code>licenseConcluded</code> は SPDX License Identifier または &quot;NOASSERTION&quot;</li>
<li><code>downloadLocation</code> は有効なURL または &quot;NOASSERTION&quot;</li>
</ul>
<h3 id="dependency-snapshot">Dependency Snapshot</h3>
<ul>
<li><code>version</code> は 0 固定</li>
<li><code>sha</code> は有効なGitコミットSHA</li>
<li><code>package_url</code> はPackage URL仕様に準拠</li>
</ul>
<hr>
<h2 id="まとめ">まとめ</h2>
<p>この機能はアプリケーションコードの変更を伴わないため、新しいデータモデルの実装は不要です。上記のデータ構造はすべて：</p>
<ol>
<li><strong>Microsoft SBOM Tool</strong> が自動生成（SPDX Document）</li>
<li><strong>GitHub Actions</strong> が構築（Dependency Snapshot、Workflow Config）</li>
<li><strong>GitHub API</strong> が定義（Release Asset）</li>
</ol>
<p>したがって、Phase 2のタスク分解では、これらの外部ツール・APIの正しい使用に焦点を当てます。</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/kuju63/wt/blob/main/specs/004-complete-sbom-generation/data-model.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
