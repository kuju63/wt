# AI エージェント共通ルール

このドキュメントは、プロジェクトで使用する AI エージェントに対する共通ルールを定義します。

## 1. コミュニケーション言語

- **日本語を優先**とします
- ユーザーから英語で問いかけられた場合には、英語で回答すること
- 技術用語は適切に英語を併記することが望ましい

## 2. 質問のガイドライン

- ユーザーに対する質問は**単一**とすること
- 複数の質問をまとめて行わないこと
- 一つの質問に対する回答を得てから、次の質問を行うこと

## 3. 技術的な質問への対応

- 技術的な質問を行う際は、詳細を明確にすること
- ユーザーが**複数の選択肢から選定できるように**情報を提供すること
- 各選択肢のメリット・デメリットを提示すること
- 推奨案がある場合は、その理由とともに提示すること

## 4. 開発スタイル

プロジェクトは以下の開発スタイルをベースとします:

- **SDD (Specification-Driven Development)**: 仕様駆動開発
- **TDD (Test-Driven Development)**: テスト駆動開発

### 開発ワークフロー

以下のワークフローに従って開発を進めます:

```mermaid
flowchart TD
    A[要件・課題の確認] --> B[仕様書作成<br/>Spec Kitを使用]
    B --> C{仕様レビュー}
    C -->|修正必要| B
    C -->|承認| D[テスト設計]
    D --> E[テストコード作成<br/>Red: テスト失敗を確認]
    E --> F[実装<br/>Green: テストが通る最小限の実装]
    F --> G{テスト実行}
    G -->|失敗| F
    G -->|成功| H[リファクタリング<br/>コード品質の向上]
    H --> I{テスト実行}
    I -->|失敗| H
    I -->|成功| J{仕様を満たしているか}
    J -->|不足| D
    J -->|完了| K[コミット準備]
    K --> L[変更内容確認]
    L --> M[コミットメッセージ<br/>Draft提供]
    M --> N[ユーザーがコミット実行]
```

**ワークフローのポイント:**

1. **仕様優先**: 実装前に必ず仕様書を作成し、レビューを行う
2. **Red-Green-Refactor**: TDD の基本サイクルを遵守する
3. **小さなステップ**: 一度に多くの変更を行わず、小さな単位で進める
4. **継続的な検証**: 各ステップでテストを実行し、品質を保証する
5. **ユーザー主導**: 最終的なコミットはユーザーが判断・実行する

## 5. SDD の実装

- SDD の実装には **Spec Kit** を使用すること
- Spec Kit は GitHub が提供する仕様駆動開発のためのツールです
  - 公式リポジトリ: <https://github.com/github/spec-kit>
- Spec Kit がインストールされていない場合は、ユーザーにインストールを促すこと

### Spec Kit のインストール

```bash
uv tool install specify-cli --from git+https://github.com/github/spec-kit.git
```

### 仕様書の管理

- 仕様書の作成と管理は Spec Kit の規約に従うこと

### API ドキュメントの生成

- APIドキュメントの生成には`docfx`を使用すること（バージョン: 2.78.4）
- ドキュメントコメントの作成対象はpublic,protected,protected internalとなるclass,interface,enum,struct,delegate,fieldに限定すること
- ドキュメントコメントのフォーマットはXMLドキュメントコメントを使用すること
- ドキュメントコメントは英語で記述すること
- ドキュメントコメントの記述は[dotnet-api-docs](https://github.com/dotnet/dotnet-api-docs/wiki)を参照のこと

### ドキュメントの自動化システム

プロジェクトは GitHub Pages を使用した自動ドキュメント公開システムを実装しています:

#### 1. ドキュメントの種類と管理方法

**ユーザー向けドキュメント(手動管理)**:

- `docs/installation.md` - インストールガイド(手動編集)
- `docs/contributing.md` - コントリビューションガイド(手動編集)
- その他の `docs/` 内のMarkdownファイル(手動編集)

**コマンドドキュメント(自動生成)**:

- `docs/commands/*.md` - CLIコマンドのリファレンス
- `docs/command-reference.md` - コマンド一覧
- **重要**: これらは `Tools/DocGenerator` により System.CommandLine から自動生成されるため、直接編集しないこと

**API リファレンス(自動生成)**:

- `api/` ディレクトリ - .NET API ドキュメント
- **重要**: DocFX により XML ドキュメントコメントから自動生成されるため、直接編集しないこと

#### 2. ドキュメントのテストとビルド

**ローカルテスト**:

```bash
# コマンドドキュメント生成
cd Tools/DocGenerator && dotnet run -- ../../docs

# DocFX ビルド
docfx build docfx.json

# ローカルプレビュー
open _site/index.html  # または xdg-open on Linux
```

**CI/CDテスト**:

- DocFX ビルド時に `--warningsAsErrors` フラグで壊れたリンクを検出
- LinkChecker によるリンク検証
- ドキュメントのユニットテストは不要

#### 3. バージョン管理

- ドキュメントはマイナーバージョンレベルで管理（v0.1、v1.0、v1.1など）
- パッチバージョンは同じドキュメントを共有（v1.0.0、v1.0.1 → v1.0）
- 各バージョンの URL は 2 年以上安定して維持
- バージョン切り替えは自動的に実装される（`version-manifest.json`）

#### 4. AI エージェント向けガイダンス

**ドキュメントについて質問された場合**:

1. コンテンツが手動管理か自動生成かを判断
2. 手動管理の場合: Markdown ファイルを直接編集
3. 自動生成の場合: ソースコード(CLI定義または XML コメント)を更新

**新しいCLIコマンドを実装する場合**:

1. `wt.cli` の RootCommand にコマンドを追加
2. ドキュメントは次回デプロイ時に自動生成される
3. プレビューが必要な場合は DocGenerator を手動実行可能

**API を追加・変更する場合**:

1. public メンバーに XML ドキュメントコメントを追加
2. [dotnet-api-docs](https://github.com/dotnet/dotnet-api-docs/wiki) のフォーマットに従う
3. コメントは英語で記述
4. 対象: public, protected, protected internal の型/メンバー

## 6. バージョン管理とコミット

- **コミットはユーザーが行う**こと
- AI エージェントが直接コミットを実行してはならない
- ただし、**コミットメッセージの Draft を提供すること**は許容される
- コミット前に変更内容の確認を促すこと

## 7. コミットメッセージの規約

- コミットメッセージは**英語で記述**すること
- コミットメッセージは **Conventional Commits** に準拠すること（scope は原則使用しない）
- 基本フォーマット: `<type>: <subject>`（scope が必要な場合のみ `<type>(scope): <subject>` とする）
- 主な type:
  - `feat`: 新機能
  - `fix`: バグ修正
  - `docs`: ドキュメントのみの変更
  - `style`: コードの意味に影響を与えない変更（空白、フォーマット等）
  - `refactor`: バグ修正や機能追加を伴わないコード変更
  - `test`: テストの追加や修正
  - `chore`: ビルドプロセスやツールの変更
